<script type="text/javascript">
$(function() {

  var product_subcategories = [
    <% @product_subcategories.each do |product_subcategory| %>
      [<%= product_subcategory.product_category_id %>, <%= product_subcategory.id %>, '<%= product_subcategory.name %>'], 
    <% end %>
    ['','','']
  ];

  
  var product_category = $('#product_product_category_id').val();
   
  if (product_category == '') {
    $('#subcategorias').hide();       
  }
  else {
    var subcat_length = product_subcategories.length;
    for (var i = 0; i < subcat_length; i++) {
      var subcategory = product_subcategories[i];
      if (subcategory[0] == product_category) {
        $('#product_product_subcategory_id').append("<option value=" + subcategory[1] + ">" + subcategory[2] + "</option>");  
      }
    }
    $('#subcategorias').show();
  }
    


  $('#product_product_category_id').change(function(){ 
    $('#product_product_subcategory_id').find('option').remove().end(); 
    var product_category = $('#product_product_category_id').val();
    $('#product_product_subcategory_id').append('<option value=""></option>');    
    if (product_category == '') {
      $('#subcategorias').hide();	
    }
    else {
      var subcat_length = product_subcategories.length;
      for (var i = 0; i < subcat_length; i++) {
        var subcategory = product_subcategories[i];
        if (subcategory[0] == product_category) {
          $('#product_product_subcategory_id').append("<option value=" + subcategory[1] + ">" + subcategory[2] + "</option>");  
        }
      }
      $('#subcategorias').show();
    }
  });
});
</script>


<h1>Productos </h1>

	<p>Seleccione el criterio que desea para filtrar los resultados </p>
	<%= form_for :product, url: lookup_admin_products_path, html: {class: "form-horizontal"} do |form| %>
    <div class="form-group">
		  <%= form.label "Marca", class: "col-sm-1 control-label" %>	
		  <div class="col-sm-2">
		    <%= form.select :supplier_id, @suppliers.collect {|s| [s.name, s.id]}, {include_blank: true}, {class: "form-control"}	%>
		  </div>
		  <%= form.label "Categoria", class: "col-sm-1 control-label"	%>	
		  <div class="col-sm-2">
		    <%= form.select :product_category_id, @product_categories.collect {|pc| [pc.name, pc.id]}, {include_blank: true}, {class: "form-control"}	%>
		  </div>
			<div id="subcategorias">
			  <%= form.label "Subcategoria", class: "col-sm-2 control-label"  %>
			  <div class="col-sm-4">
			    <%= form.select :product_subcategory_id, [["",""]], class: "form-control"  %>
			  </div>
			</div>
		</div>
		<div class="form-group">
		  <%= render partial: "product_autocomplete", locals: {form: form} %>
		  <div class="col-sm-2">
		    <%= submit_tag "Buscar", {class: "btn btn-primary"}	%>
		  </div>
		</div>
	<% end %>
	<br><br>
	<hr>
	<br>
	<% if request.post?	%>
		<% unless @products.empty?	%>
			<table class="table table-striped">
				<tr><th>Nombre	</th>	<th>Marca	</th>	<th>Categoria	</th>	<th>Imagen	</th></tr>
				<% @products.each do |product|	%>
					<tr><td><%= link_to product.name, admin_product_path(product)		%>	</td>
						<td><%= product.supplier.name									%>	</td>
						<td><%= product.product_category.nil? ? "" : product.product_category.name	%>	</td>
						<td><%= product.product_picture.nil? ? "" : image_tag(product.product_picture.url, :size => "40x40")			%>	</td>
						<td><%= link_to "Modificar", edit_admin_product_path(product)	%>	</td>
						<td><%= button_to("Eliminar", admin_product_path(product),method: :delete) 			%>	</td>
					</tr>
				<% end %>
			</table>
		<% else %>
			<p>No hay productos que coincidan con su criterio de busqueda.  Por favor intente de nuevo.</p>
		<% end 	%>
	<% end %>
	<br><br>
	<hr>
	<br>
	<%= link_to "Crear Nuevo Producto", new_admin_product_path	%>
